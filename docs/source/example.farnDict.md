# farnDict file

## Description

A farnDict is a file in C++ dictionary format used with farn

A farnDict
* defines the layers, the parameters varied per layer and the related sampling used to create the samples per layer
* after sampling, the layers, parameters and generated samples per layer make up the designspace that farn traverses
* farn creates one distinct case folder for each sample, making up a nested case folder structure
* nest levels and - dimensions of the case folder sructure follows the sequence of layers as defined in the farn dict

## Terms & Definition

| element / key                            | type                          | Description |
| :----------------------------------------| :---------------------------- | :---------- |
| _environment                             | dict                          | [optional] dict with system variables set at runtime, commonly containing folder paths, which can subsequently be referenced in shell commands defined in _commands |
| _layers                                  | dict                          | dict defining all layers. Each layer represents one nest level in the folder structure that will be generated by farn. |
| &numsp;\<LAYER>                          | dict                          | unique key defining a layer. It serves as basename for all case folders in the nest level corresponding with this layer. |
| &numsp;&numsp;_sampling                  | dict                          | dict defining sampling-type and -parameters of a layer |
| &numsp;&numsp;&numsp;_type               | string                        | sampling type. Choices currently implemented are {'fixed', 'linSpace', 'uniformLhs'} |
| &numsp;&numsp;&numsp;_names              | list[string]                  | list naming all variables / parameters being varied in this layer. For each variable / parameter named here, sampled values will be generated. |
| &numsp;&numsp;&numsp;_values             | list[list[*float]]            | (required for sampling type 'fixed'): List containing lists of fixed values. For each parameter name defined in _names, one list of fixed values must exist, i.e. the number of lists in _values must match the number of parameter names defined in _names. The number of values can freely be chosen. However, all lists in _values must have the same number of values. |
| &numsp;&numsp;&numsp;_ranges             | list[list[float,&nbsp;float]] | (required for sampling types 'linSpace' and 'uniformLhs'): List containing ranges. A range is defined through the lower and upper boundary value for the related parameter name, given as tuple (minimum, maximum). For each parameter name defined in _names, one range tuple must exist. |
| &numsp;&numsp;&numsp;_numberOfSamples    | int                           | (required for sampling types 'linSpace' and 'uniformLhs'): Number of samples to be generated. The given number of samples will be generated within range (=between lower and upper boundary), excluding the boundaries themselves. |
| &numsp;&numsp;&numsp;_includeBoundingBox | bool                          | (optional, for sampling type 'uniformLhs'): Defines whether the lower and upper boundary values of each parameter name shall be added as additional samples. If missing, defaults to FALSE. |
| &numsp;&numsp;_condition                 | dict                          | (optional) allows to filter out unwanted or invalid samples |
| &numsp;&numsp;&numsp;_filter             | string                        | filter expression in a pandas-like stype |
| &numsp;&numsp;&numsp;_action             | string                        | (optional) defines the action triggered when the filter expression evaluates to True. Choices: 'include', 'exclude'. If missing, defaults to 'exclude'. |
| &numsp;&numsp;_samples                   | dict                          | dict containing all samples. The '_samples' section of a layer is generated by farn when run with option --sample. |
| &numsp;&numsp;_commands                  | dict                          | (optional) dict defining commandsets that can be executed in a layer. |
| &numsp;&numsp;&numsp;\<COMMAND>       | list[string]                  | unique, user-defined identifier for a command element. A command element contains one or more shell commands, saved as a list of strings. When farn is called with -e <COMMAND> argument, all shell commands listed in <COMMAND> will be executed in the given sequence, in all case folders belonging to the layer the command element is defined in. |

## Example

Below example shows the typical structure of a farnDict file.
In the example, a 6-dimensional design space is spawned, organised in 4 layers:
1.  'gp'        level 0     (root layer)    no. of parameters: 1    sampling: fixed      (Example 'gp' indicating e.g. a hypothetical grid parameter)
2.  'lhsvar'    level 1     (nested layer)  no. of parameters: 3    sampling: uniformLhs (Example  3 dimensional sub design space, LHS sampled)
3.  'cp'        level 2     (nested layer)  no. of parameters: 1    sampling: linSpace   (Example 'cp' indicating e.g. a hypothetical compute parameter (solver setting, version whatever))
4.  'mp'        level 3     (leaf layer)  no. of parameters: 1    sampling: fixed      (Example 'mp' indicating e.g. a hypothetical multiplier for an internal variable)
~~~
/*---------------------------------*- C++ -*----------------------------------*\
filetype dictionary; coding utf-8; version 0.1; local --; purpose --;
\*----------------------------------------------------------------------------*/
_environment
{
    CASEDIR                   cases;
    DUMPDIR                   dump;
    LOGDIR                    logs;
    RESULTDIR                 results;
    TEMPLATEDIR               template;
}
_layers
{
    gp                                          // unique identifier of a layer. This identifier will be used by farn as folder name.
    {
        _sampling
        {
            _type fixed;                        // Fixed values. Note: Each sampling type has its own set of required arguments.
            _names(mpGrid);                     // list with names, each representing one variable or parameter.
            _values((0.9 1.3));                 // list containing tuples with fixed values, one tuple for each parameter name. Required for sampling type 'fixed'.
        }
    }
    lhsvar
    {
        _sampling
        {
            _type uniformLhs;                   // Latin-Hypercube-Sampling. Future options might also include normallhs, lognormlhs etc.
            _names(param1 param2 param3);
            _ranges((-10 10)(0 3.5)(0 1.1));    // list containing ranges. A range is defined through the lower and upper boundary value for the related parameter name, given as tuple (minimum, maximum). For each parameter name, one range tuple must exist.
            _includeBoundingBox True;           // [optional] defines whether the lower and upper boundary values of each parameter name shall be added as additional samples. If missing, defaults to False.
            _numberOfSamples 100;               // number of samples to be generated. The given number of samples will be generated within range (=between lower and upper boundary), excluding the boundaries themselves.
        }
    }
    cp
    {
        _sampling
        {
            _type linSpace;                     // Linearly spaced sampling.
            _names(relFactor);
            _ranges((0.5 0.8));
            _numberOfSamples 5;
        }
        _condition                              // a condition allows to define a filter expression to include or exclude specific samples.
        {
            _filter  'param2 >= param3 and param1 >= 0'; // filter expression.
            _action  exclude;                            // [optional] defines the action triggered when the filter expression evaluates to True. choices: 'include', 'exclude'. If missing, defaults to 'exclude'.
        }
    }
    mp
    {
        _sampling
        {
            _type fixed;
            _names(cpMul ppMul);                // hypothetical multiplier for solver and postprocessing, whatever
            _values((1.5 2.0 3.5)(1.5 2.0 3.5));
        }
        _commands                               // commands. Each command element contains a list with one or more shell commands.
        {
            prepare                             // command 'prepare'
                (
                    'copy %TEMPLATEDIR%/caseDict'
                    'rem parsed.caseDict'
                    'dictParser --quiet caseDict'
                );
            run                                 // command 'run'
                (
                    'cosim.exe run OspSystemStructure.xml -b 0 -d 20 --real-time -v'
                );
        }
    }
}
~~~
